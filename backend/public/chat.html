<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Live chat Support</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/styles.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.0/socket.io.js"></script>


</head>

<body>
<div class="bootstrap_chat">
    <div class="container py-5 px-4">
        <header class="text-center">
            <h1 class="display-4 text-white">Live chat Support</h1>
        </header>

        <!-- Chat Box-->
        <div class="col-12 px-0">
            <div id="chat-box" class="px-4 py-5 chat-box bg-white">
                <!-- Sender Message-->
                <div class="media w-50 mb-3">
                </div>

                <!-- Receiver Message-->
                <div class="media w-50 ml-auto mb-3">

                </div>
            </div>

            <!-- Typing area -->
            <form id="messageForm" class="bg-light">
                <div class="input-group">
                    <input id="messageInput" type="text" placeholder="Type a message"
                           aria-describedby="button-addon2" class="form-control rounded-0 border-0 py-4 bg-light" autocomplete="off">
                    <div class="input-group-append">
                        <button id="button-addon2" type="submit" class="btn btn-link"><i
                                class="fa fa-paper-plane"></i></button>
                    </div>
                </div>
            </form>

        </div>
    </div>
</div>
<script src="assets/js/jquery.min.js"></script>
<script src="assets/bootstrap/js/bootstrap.min.js"></script>
<script src="chat.js"></script>
<script>
    var socket = io();

    function addReceiverMessage(message) {
        var receiverMessage = `<div class="media w-50 mb-3"><img src="https://res.cloudinary.com/mhmd/image/upload/v1564960395/avatar_usae7z.svg" alt="user" width="50" class="rounded-circle">
        <div class="media-body ml-3">
            <div class="bg-light rounded py-2 px-3 mb-2">
                <p class="text-small mb-0 text-muted">${message}</p>
            </div>
            <p class="small text-muted">${getCurrentTime()}</p>
        </div>
    </div>`;

        $('#chat-box').append(receiverMessage);
    }


    function addSenderMessage(message) {
        var senderMessage = `<div class="media w-50 ml-auto mb-3">
        <div class="media-body">
            <div class="bg-primary rounded py-2 px-3 mb-2">
                <p class="text-small mb-0 text-white">${message}</p>
            </div>
            <p class="small text-muted">${getCurrentTime()}</p>
        </div>
    </div>`;

        $('#chat-box').append(senderMessage);
    }

    function sendMessage(message) {
        if (message.trim() !== '') {
            addSenderMessage(message);
            socket.emit('message', message);
        }
    }


    $('#messageForm').submit(function (e) {
        e.preventDefault();
        var message = $('#messageInput').val();
        sendMessage(message);
        $('#messageInput').val('');
    });

    socket.on('message', function (msg) {
        addReceiverMessage(msg);

    });

    function getCurrentTime() {
        var now = new Date();
        var hours = now.getHours();
        var minutes = now.getMinutes();
        var ampm = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12;
        hours = hours ? hours : 12;
        minutes = minutes < 10 ? '0' + minutes : minutes;
        var time = hours + ':' + minutes + ' ' + ampm;

        var month = now.toLocaleString('default', {month: 'short'});
        var day = now.getDate();
        var year = now.getFullYear();

        var formattedDate = month + ' ' + day + ', ' + year;
        var dateTime = time + ' | ' + formattedDate;

        return dateTime;
    }

    socket.on('connect', function () {
        console.log('Connected to the server');
    });

    socket.on('disconnect', function () {
        console.log('Disconnected from the server');
    });
</script>


</body>

</html>
